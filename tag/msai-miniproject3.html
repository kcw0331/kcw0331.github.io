<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Msai Miniproject3 - 꿈을 향해 나아가자!</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- 웹폰트 추가 -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css 추가 -->
<!--    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />-->

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="창우의 아이티블로그" />
    <link rel="shortcut icon" href="http://localhost:4000/assets/built/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="http://localhost:4000/tag/msai-miniproject3" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="꿈을 향해 나아가자!" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Msai Miniproject3 - 꿈을 향해 나아가자!" />
    <meta property="og:description" content="MSAISchool 공부에 대한 내용을 작성해 보았다. Msai - 1주차(1) Msai - 1주차(2) Msai - 1주차(3) Msai - 포커이미지 분류 Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5 Msai - 미니프로젝트 3 MMDetection(Animal Datasets) Msai - 공부하면서 알게된 것 1 Animal Label Object Detection(MMDetection) 미니 프로젝트 3 2023년" />
    <meta property="og:url" content="http://localhost:4000/tag/msai-miniproject3" />
    <meta property="og:image" content="http://localhost:4000/assets/built/images/microsoft_logo.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-01-31T09:40:00+09:00" />
    <meta property="article:modified_time" content="2023-01-31T09:40:00+09:00" />
    <meta property="article:tag" content="Msai" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Msai Miniproject3 - 꿈을 향해 나아가자!" />
    <meta name="twitter:description" content="MSAISchool 공부에 대한 내용을 작성해 보았다. Msai - 1주차(1) Msai - 1주차(2) Msai - 1주차(3) Msai - 포커이미지 분류 Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5 Msai - 미니프로젝트 3 MMDetection(Animal Datasets) Msai - 공부하면서 알게된 것 1 Animal Label Object Detection(MMDetection) 미니 프로젝트 3 2023년" />
    <meta name="twitter:url" content="http://localhost:4000/" />
    <meta name="twitter:image" content="http://localhost:4000/assets/built/images/microsoft_logo.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="꿈을 향해 나아가자!" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Msai" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "꿈을 향해 나아가자!",
        "logo": "http://localhost:4000/"
    },
    "url": "http://localhost:4000/tag/msai-miniproject3",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:4000/assets/built/images/microsoft_logo.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/tag/msai-miniproject3"
    },
    "description": "MSAISchool 공부에 대한 내용을 작성해 보았다. Msai - 1주차(1) Msai - 1주차(2) Msai - 1주차(3) Msai - 포커이미지 분류 Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5 Msai - 미니프로젝트 3 MMDetection(Animal Datasets) Msai - 공부하면서 알게된 것 1 Animal Label Object Detection(MMDetection) 미니 프로젝트 3 2023년"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Msai - 미니프로젝트3 MMDetection(Animal Datasets)" href="/feed.xml" />


    <!--  2023년 2월 21일 블로그에 수식이 안되서 적은 아래 2개코드 -->
    

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="http://localhost:4000/">꿈을 향해 나아가자!</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/tag/jekyll/">Jekyll</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-msai" role="menuitem"><a href="/tag/msai/">Msai</a></li>
    <li class="nav-coding" role="menuitem"><a href="/tag/coding/">Coding</a></li>
    <li class="nav-paper" role="menuitem"><a href="/tag/paper/">Paper</a></li>
    <li class="nav-cs" role="menuitem"><a href="/tag/cs/">Cs</a></li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>
</ul>
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-msai post tag-msai ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="31 January 2023">31 January 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/msai/'>MSAI</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Msai - 미니프로젝트3 MMDetection(Animal Datasets)</h1>
            </header>

            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/microsoft_logo.jpg)">
            </figure>
            
            -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p><span class="table-of-contents-list">MSAISchool 공부에 대한 내용을 작성해 보았다. </span></p>
<ul class="table-of-contents-list">
    <li><a href="./msai-1weeks(1)">Msai - 1주차(1)</a></li>
    <li><a href="./msai-1weeks(2)">Msai - 1주차(2)</a></li>
    <li><a href="./msai-1weeks(3)">Msai - 1주차(3)</a></li>
    <li><a href="./msai-pokerimageclassification">Msai - 포커이미지 분류</a></li>
    <li><a href="./msai-miniproject2">Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5</a></li>
    <li><a href="./msai-miniproject3">Msai - 미니프로젝트 3 MMDetection(Animal Datasets)</a></li>
    <li><a href="./msai-studyknow">Msai - 공부하면서 알게된 것 1</a></li>
</ul>

<h1 id="-animal-label-object-detectionmmdetection-"><center> Animal Label Object Detection(MMDetection) </center></h1>
<h2 id="미니-프로젝트-3"><center>미니 프로젝트 3</center></h2>

<h4 id="2023년-1월-31일화">2023년 1월 31일(화)</h4>

<h2 id="1-dataset-구성">1) Dataset 구성</h2>

<ul>
  <li>ainmals.v2-release.coco
    <ul>
      <li>test
        <ul>
          <li>images(jpg), _annotations.coco.json</li>
        </ul>
      </li>
      <li>train
        <ul>
          <li>images(jpg), _annotations.coco.json</li>
        </ul>
      </li>
      <li>valid
        <ul>
          <li>images(jpg), _annotations.coco.json</li>
        </ul>
      </li>
      <li>README.dataset.txt</li>
      <li>README.roboflow.txt</li>
    </ul>
  </li>
  <li>Dataset는 아래 테이블과 같이 구성되어 있습니다.</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Data</th>
      <th style="text-align: center">이미지 개수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Test</td>
      <td style="text-align: center">100</td>
    </tr>
    <tr>
      <td style="text-align: center">Train</td>
      <td style="text-align: center">700</td>
    </tr>
    <tr>
      <td style="text-align: center">Valid</td>
      <td style="text-align: center">200</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Category는 아래 테이블과 같이 구성되어 있습니다.</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Category Number</th>
      <th style="text-align: center">Category Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">0</td>
      <td style="text-align: center">animals(Background)</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">cat</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">chicken</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">cow</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">dog</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">fox</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td style="text-align: center">goat</td>
    </tr>
    <tr>
      <td style="text-align: center">7</td>
      <td style="text-align: center">horse</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">person</td>
    </tr>
    <tr>
      <td style="text-align: center">9</td>
      <td style="text-align: center">racoon</td>
    </tr>
    <tr>
      <td style="text-align: center">10</td>
      <td style="text-align: center">skunk</td>
    </tr>
  </tbody>
</table>

<h2 id="2-mmdetection-적용">2) MMDetection 적용</h2>

<h3 id="2-1-train_toolpy를-만들어-준다">2-1) train_tool.py를 만들어 준다.</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#2023년 1월 31일 미니프로젝트 3 animaals 데이터 클래스는 10개이다.
#필요한 패키지를 추가해주었다.
</span><span class="kn">import</span> <span class="nn">mmcv</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">mmdet.apis</span> <span class="kn">import</span> <span class="n">init_detector</span><span class="p">,</span> <span class="n">inference_detector</span>
<span class="kn">from</span> <span class="nn">mmdet.datasets.builder</span> <span class="kn">import</span> <span class="n">DATASETS</span>
<span class="kn">from</span> <span class="nn">mmdet.datasets.coco</span> <span class="kn">import</span> <span class="n">CocoDataset</span>
<span class="kn">from</span> <span class="nn">mmdet.datasets</span> <span class="kn">import</span> <span class="n">build_dataset</span>
<span class="kn">from</span> <span class="nn">mmdet.models</span> <span class="kn">import</span> <span class="n">build_detector</span>
<span class="kn">from</span> <span class="nn">mmdet.apis</span> <span class="kn">import</span> <span class="n">set_random_seed</span>
<span class="kn">from</span> <span class="nn">mmdet.apis</span> <span class="kn">import</span> <span class="n">train_detector</span>
<span class="kn">from</span> <span class="nn">mmdet.utils</span> <span class="kn">import</span> <span class="n">collect_env</span><span class="p">,</span> <span class="n">get_root_logger</span><span class="p">,</span> <span class="n">setup_multi_processes</span>
<span class="kn">from</span> <span class="nn">mmcv.runner</span> <span class="kn">import</span> <span class="n">get_dist_info</span><span class="p">,</span> <span class="n">init_dist</span>
<span class="kn">from</span> <span class="nn">mmcv</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="c1"># Dataset regiset 데이터 셋에 등록이 필요하다
# 포맷 자체가 CoCo데이터 셋을 가져온다.
</span><span class="o">@</span><span class="n">DATASETS</span><span class="p">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 등록을 해준다.
</span><span class="k">class</span> <span class="nc">AnimalLabelDataset</span><span class="p">(</span><span class="n">CocoDataset</span><span class="p">):</span> <span class="c1"># 상속을 받게 된다.
</span>    <span class="c1"># CoCo데이터 셋에는 클래스가 1,000개인데, 우리가 원하는 클래스를 지정해준다
</span>    <span class="n">CLASSES</span> <span class="o">=</span> <span class="p">(</span><span class="s">'animals'</span><span class="p">,</span> <span class="s">'cat'</span><span class="p">,</span> <span class="s">'chicken'</span><span class="p">,</span> <span class="s">'cow'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'fox'</span><span class="p">,</span> <span class="s">'goat'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'person'</span><span class="p">,</span> <span class="s">'racoon'</span><span class="p">,</span> <span class="s">'skunk'</span><span class="p">)</span>

<span class="c1"># config
# config파일을 불러와야 한다
</span><span class="n">config_file</span> <span class="o">=</span> <span class="s">'./configs/dynamic_rcnn/dynamic_rcnn_r50_fpn_1x_coco.py'</span> <span class="c1"># 해당하는 아키텍처를 가져온다.(faster_rcnn을 많이 쓴다. dynamic_rcnn도 많이 쓴다., centernet, mask_rcnn은 세그멘테이션에서 사용한다., cascade_rcnn도 많이 쓴다.(cascade_rcnn_r50_fpn_1x_coco.py많이씀))
</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="c1"># config를 읽어 들인다.
# 어디에 num_classes가 있는지 확인을 해야 한다.
# 아래 print(cfg.pretty_text)를 사용해서
# print(cfg.pretty_text) # 해당하는 파일들을 가져온다.
</span>
<span class="c1"># Learning rate setting
# single GPU -&gt; 0.0025
# cfg.optimizer.lr = 0.02/8 &lt;- 보통은 8개 GPU를 사용하기 때문에 이렇게 해준다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">optimizer</span><span class="p">.</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">0.0025</span> <span class="c1"># learning rate를 설정해준다.
</span>
<span class="c1"># dataset setting
# 데이터 셋을 설정해준다
</span><span class="n">cfg</span><span class="p">.</span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span> <span class="c1"># coco_detection.py에 있는 것을 바꾸어준다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">data_root</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco"</span> <span class="c1"># 루트를 지정해준다.
</span>
<span class="c1"># train, val, test dataset &gt;&gt; type data root and file img_prefix setting
# coco_detection.py에 있는 3가지(type, ann_file, img_prefix) 부분을 변경해준다
# 경로 설정을 해준다. coco_detection.py에 있는
# agmentation을 해주려면 train_pipeline쪽에서 수정을 해주어야 한다.
# trian 작성
</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">ann_file</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/train/_annotations.coco.json"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">img_prefix</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/train/"</span> <span class="c1"># 데이터셋만 지정하면 뒤에 알아서 train이 붙는다.
</span>
<span class="c1"># val 작성
</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">ann_file</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/valid/_annotations.coco.json"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">img_prefix</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/valid/"</span>

<span class="c1"># test 작성
</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">ann_file</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/test/_annotations.coco.json"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">img_prefix</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/test/"</span>

<span class="c1"># class number
# 항상 이 부분을 주의해야 한다.
# faster_rcnn_r50_fpn.py에서 수정을 해준다.
# 로이 안에서 80인 부분은 11으로 변경해준다.
# 접근 방식을 .으로 접근하면 된다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">roi_head</span><span class="p">.</span><span class="n">bbox_head</span><span class="p">.</span><span class="n">num_classes</span> <span class="o">=</span> <span class="mi">11</span>

<span class="c1"># 8로하게 되면 작은 물체가 더 작아지기 때문에 4로 수정한다.
# small object -&gt; change anchor -&gt; df : size 8 -&gt; size 4로 수정한다
# 8이면 스케일이 켜지는 것인데 작은 이미지는 더 작아지게 되므로 4로 하게 해주었다.(안그러면 작은 데이터를 더 작게 만든다.)
</span><span class="n">cfg</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">rpn_head</span><span class="p">.</span><span class="n">anchor_generator</span><span class="p">.</span><span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>

<span class="c1"># pretrained call
# pretrained를 가져온다. 모듈을 가져온다. 아키텍처에 해당하는 pth파일을 가져와야 한다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">load_from</span> <span class="o">=</span> <span class="s">"./dynamic_rcnn_r50_fpn_1x-62a3f276.pth"</span>

<span class="c1"># train model save dir
# train 모델을 저장하는 경로를 지정한다. (모델을 저장할 공간을 설정해준다.)
</span><span class="n">cfg</span><span class="p">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="s">"./work_dirs/0131"</span>

<span class="c1"># lr, hyp setting
# 러닝 레이트랑 하이퍼파라메타를 세팅한다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">lr_config</span><span class="p">.</span><span class="n">warmup</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">log_config</span><span class="p">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># 10번째 마나 띄워준다. # 어느정도에서 볼지 정해준다.
</span>
<span class="c1"># coco dataset evaluation type = bbox
# coco 데이터 셋 평가 타입을 bbox로 잡는다. (그러면 0.5 ~ 0.95사이의 값을 갖는다.)
# mAP iou threshold 0.5 ~ 0.95
</span><span class="n">cfg</span><span class="p">.</span><span class="n">evaluation</span><span class="p">.</span><span class="n">metric</span> <span class="o">=</span> <span class="s">'bbox'</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">evaluation</span><span class="p">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># 언제쯤 볼지 정해준다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">checkpoint_config</span><span class="p">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># 언제쯤 저장을 해줄지 해주는 것이다.
# 투스테이션에서는 best를 뽑을 수는 없다.
</span>
<span class="c1"># epoch setting
# 보통 8 x 12정도로 하게 된다. -&gt; 96(8개 GPU를 사용할 때, 12번 돌린다)
# num work랑 gpu를 설정해주는 방법이다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">max_epochs</span> <span class="o">=</span> <span class="mi">88</span> <span class="c1"># 90정도의 에포크를 돌린다. 데이터가 충분히 있다면 88정도 해주어도 괜찮다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">777</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">samples_per_gpu</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># 싱글로 할 때는 6하고 2는 고정이다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">workers_per_gpu</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># print("cfg.data &gt;&gt;", cfg.data)
</span><span class="n">cfg</span><span class="p">.</span><span class="n">gpu_ids</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># gpu가 몇개인지 개수를 파악하는 것이다.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="s">"cuda"</span>
<span class="n">set_random_seed</span><span class="p">(</span><span class="mi">777</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># print("cfg info show", cfg.pretty_text)
</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">build_dataset</span><span class="p">((</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">))]</span> <span class="c1"># 트레인용 데이터 셋을 생성하는 것이다.
# print("dataset[0]", datasets[0])
</span>
<span class="c1"># datasets[0].__dict__ variables key val
</span><span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">__dict__</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1"># 모델을 불러주는 것이다.
</span><span class="n">model</span> <span class="o">=</span> <span class="n">build_detector</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="n">train_cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"train_cfg"</span><span class="p">),</span>
                       <span class="n">test_cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'test_cfg'</span><span class="p">))</span>
<span class="n">model</span><span class="p">.</span><span class="n">CLASSES</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">CLASSES</span>
<span class="c1"># print(model.CLASSES)
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">train_detector</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">distributed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-2-inferencepy을-만들어-준다">2-2) inference.py을 만들어 준다.</h3>

<ul>
  <li>train_tool.py을 통해 학습된 epoch.pth를 사용하여 test 이미지에 적용을 시켜준다.</li>
  <li>inference.py를 작성할 때는 train_tool.py에서 작성하였던 내용과 동일하게 적용시켜주어야 한다.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 2023년 1월 31일 오전 수업
</span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">mmdet.apis</span> <span class="kn">import</span> <span class="n">inference_detector</span><span class="p">,</span> <span class="n">init_detector</span>
<span class="kn">from</span> <span class="nn">mmdet.datasets</span> <span class="kn">import</span> <span class="n">build_dataset</span>
<span class="kn">from</span> <span class="nn">mmdet.models</span> <span class="kn">import</span> <span class="n">build_detector</span>
<span class="kn">from</span> <span class="nn">mmdet.datasets</span> <span class="kn">import</span> <span class="n">DATASETS</span>
<span class="kn">from</span> <span class="nn">mmdet.datasets.coco</span> <span class="kn">import</span> <span class="n">CocoDataset</span>
<span class="kn">from</span> <span class="nn">mmcv</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">mmdet.apis</span> <span class="kn">import</span> <span class="n">set_random_seed</span>

<span class="c1"># Config 설정 (Train과 동일하다)
</span>
<span class="c1"># 1. Dynamic RCNN setting ...
# config파일을 가져온다.
</span><span class="n">config_file</span> <span class="o">=</span> <span class="s">"./configs/dynamic_rcnn/dynamic_rcnn_r50_fpn_1x_coco.py"</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="c1"># 이렇게 해줘야 Config를 사용할 수 있다.
# 2. DATASET.register
</span><span class="o">@</span><span class="n">DATASETS</span><span class="p">.</span><span class="n">register_module</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 데이터 세트를 가져온다.
</span><span class="k">class</span> <span class="nc">AnimalLabelDataset</span><span class="p">(</span><span class="n">CocoDataset</span><span class="p">):</span> <span class="c1"># 상속을 받게 된다.
</span>    <span class="c1"># CoCo데이터 셋에는 클래스가 1,000개인데, 우리가 원하는 클래스를 지정해준다
</span>    <span class="n">CLASSES</span> <span class="o">=</span> <span class="p">(</span><span class="s">'animals'</span><span class="p">,</span> <span class="s">'cat'</span><span class="p">,</span> <span class="s">'chicken'</span><span class="p">,</span> <span class="s">'cow'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'fox'</span><span class="p">,</span> <span class="s">'goat'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'person'</span><span class="p">,</span> <span class="s">'racoon'</span><span class="p">,</span> <span class="s">'skunk'</span><span class="p">)</span>

<span class="c1"># 3. dataset setting ...
# 하이퍼파라메터를 세팅해준다.
# 데이터 타입과 데이터 루트
</span><span class="n">cfg</span><span class="p">.</span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data_root</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco"</span>

<span class="c1"># train, val, test dataset에 대한 type, data_root, anno_file, img_prefix, hyp setting ...
</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">ann_file</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/train/_annotations.coco.json"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">img_prefix</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/train/"</span>

<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">ann_file</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/valid/_annotations.coco.json"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">img_prefix</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/valid/"</span>

<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="s">"AnimalLabelDataset"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">ann_file</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/test/_annotations.coco.json"</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">img_prefix</span> <span class="o">=</span> <span class="s">"./animals.v2-release.coco/test/"</span>

<span class="c1"># 4. model class number setting ...
# 로이 헤더에 위치해 있다고 하심.
</span><span class="n">cfg</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">roi_head</span><span class="p">.</span><span class="n">bbox_head</span><span class="p">.</span><span class="n">num_classes</span> <span class="o">=</span> <span class="mi">11</span>

<span class="c1"># 5. pretrained model
</span><span class="n">cfg</span><span class="p">.</span><span class="n">load_from</span> <span class="o">=</span> <span class="s">"./dynamic_rcnn_r50_fpn_1x-62a3f276.pth"</span>

<span class="c1"># 6. weight file save dir setting ...
</span><span class="n">cfg</span><span class="p">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="s">"./0131"</span>

<span class="c1"># 7. train setting hyp
</span><span class="n">cfg</span><span class="p">.</span><span class="n">lr_config</span><span class="p">.</span><span class="n">wrmup</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">log_config</span><span class="p">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># 8. CocoDataset metric -&gt; bbox (bbox mAP iou threshold 0.5 ~ 0.95까지 변경하면서 측정한다.)
</span><span class="n">cfg</span><span class="p">.</span><span class="n">evaluation</span><span class="p">.</span><span class="n">metric</span> <span class="o">=</span> <span class="s">'bbox'</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">evaluation</span><span class="p">.</span><span class="n">iterval</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">checkpoint_config</span><span class="p">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Epoch setting
</span><span class="n">cfg</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">max_epoch</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">gpu_ids</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">set_random_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># Model Load
</span><span class="n">checkpoint_file</span> <span class="o">=</span> <span class="s">"./work_dirs/0130/epoch_40.pth"</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">init_detector</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">checkpoint_file</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s">"cuda"</span><span class="p">)</span> <span class="c1"># 학습했던 정보를 동일하게 넣어 주어야 한다.
# pretrained를 사용했던 것 까지 넣어주어야 한다.
</span>
<span class="s">"""
# one image result show
# 한장의 이미지에 대해서 볼 수 있다.
from mmdet.apis import show_result_pyplot
img = "./dataset/test/511_jpg.rf.b70e77817865b09f7004a1a82401c850.jpg"
# cv2에 이미지를 넣어준다.
images = cv2.imread(img)
results = inference_detector(model, images)
# mmdetection에서 한장의 이미지를 보고 싶을 때, show_result_pyplot을 만들어 둔 것이다.
show_result_pyplot(model, img, results)
"""</span>

<span class="n">img_info_path</span> <span class="o">=</span> <span class="s">"./dataset/test/_annotations.coco.json"</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_info_path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">image_info</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># threshold
</span><span class="n">score_threshold</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="c1"># annotation을 만들기 위한 리스트를 만든다.
</span><span class="n">submission_anno</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="c1"># image one -&gt; inference
# 이미지를 하나씩 순회 하면서 inference를 보는 것이다.
</span><span class="k">for</span> <span class="n">img_info</span> <span class="ow">in</span> <span class="n">image_info</span><span class="p">[</span><span class="s">'images'</span><span class="p">]:</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">img_info</span><span class="p">[</span><span class="s">'file_name'</span><span class="p">]</span>
    <span class="n">img_height</span> <span class="o">=</span> <span class="n">img_info</span><span class="p">[</span><span class="s">'height'</span><span class="p">]</span>
    <span class="n">img_width</span> <span class="o">=</span> <span class="n">img_info</span><span class="p">[</span><span class="s">'width'</span><span class="p">]</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"./dataset/test/"</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="c1"># cv2를 하려면 cv2로 읽어야 한다.
</span>    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="n">image_copy</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">image_resize</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image_copy</span><span class="p">,</span> <span class="p">(</span><span class="mi">960</span><span class="p">,</span> <span class="mi">540</span><span class="p">))</span> <span class="c1"># 리사이즈를 해준다.
</span>
    <span class="c1"># scale 스케일을 계산해준다.
</span>    <span class="n">x_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">960</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_width</span>
    <span class="n">y_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">540</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_height</span>
    <span class="c1"># print(x_scale, y_scale) #2.0 1.7419354838709677
</span>    <span class="c1"># 우리가 구한 x, y에 곱해주면 된다.
</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">inference_detector</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">img_path</span><span class="p">)</span> <span class="c1"># 경로로 넣어 주어도 동작을 한다.
</span>    <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="c1"># 아무것도 없다면 continue해준다.
</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># threshold setting ...
</span>        
        <span class="c1"># json으로 만들기 위해 카테고리아이디를 해줌
</span>        <span class="n">category_id</span> <span class="o">=</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="c1"># 변수를 하나 만들어 준다.
</span>        <span class="n">result_filtered</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">result</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">score_threshold</span><span class="p">)]</span> <span class="c1"># 0.5이상인 애들만 나오게 된다.
</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#
</span>            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">))</span> <span class="p">:</span> <span class="c1"># 살아남은 애들만 for문을 돌려준다.
</span>            <span class="c1"># print(result_filtered) # [[  4.6392226  206.71797     14.983432   261.69467      0.88920397]]
</span>            <span class="n">tmp_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            
            <span class="n">x_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

            <span class="c1"># xyxy to xywh
</span>            <span class="c1"># json을 만들어 주기 위해 만들어 준다.
</span>            <span class="n">json_x</span> <span class="o">=</span> <span class="n">x_min</span>
            <span class="n">json_y</span> <span class="o">=</span> <span class="n">y_min</span>
            <span class="n">json_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>
            <span class="n">json_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span>
            <span class="c1"># print(json_x, json_y, json_w, json_h) # 4 206 10 55
</span>
            <span class="n">tmp_dict</span><span class="p">[</span><span class="s">'bbox'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">json_x</span><span class="p">,</span> <span class="n">json_y</span><span class="p">,</span> <span class="n">json_w</span><span class="p">,</span> <span class="n">json_h</span><span class="p">]</span>
            <span class="n">tmp_dict</span><span class="p">[</span><span class="s">'category_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">category_id</span>
            <span class="n">tmp_dict</span><span class="p">[</span><span class="s">'area'</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_w</span> <span class="o">*</span> <span class="n">json_h</span>
            <span class="n">tmp_dict</span><span class="p">[</span><span class="s">'image_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">img_info</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
            <span class="n">tmp_dict</span><span class="p">[</span><span class="s">'score'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="c1"># i의 4번재 값을 뽑아온다.
</span>
            <span class="n">submission_anno</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dict</span><span class="p">)</span>
            <span class="c1"># 그리고 json 덤프를 하면 된다.
</span>
            <span class="c1"># scale bbox
</span>            <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_min</span> <span class="o">*</span> <span class="n">x_scale</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_min</span> <span class="o">*</span> <span class="n">y_scale</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_max</span> <span class="o">*</span> <span class="n">x_scale</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_max</span> <span class="o">*</span> <span class="n">y_scale</span><span class="p">)</span>
            <span class="n">cv2</span><span class="p">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image_resize</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># cv2.rectangle(image, (x_min, y_min), (x_max, y_max), (0, 255, 0), 2)
</span>    <span class="c1"># cv2.imshow("test", image_resize)
</span>    <span class="c1"># if cv2.waitKey() == ord('q'):
</span>    <span class="c1">#     exit()
</span>
            <span class="c1"># voc -&gt; coco xywh
</span>
            <span class="c1"># print(x_min)
</span>            <span class="c1"># exit()
</span>
    <span class="c1"># json을 만들어 주기 위해 dump를 사용해서 만들어 준다.
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"./json_test/test.json"</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">submission_anno</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="3-테스트-이미지-적용-결과">3) 테스트 이미지 적용 결과</h2>

<ul>
  <li>테스트 이미지 하나를 사용하여 바운딩 박스를 해준 결과입니다.</li>
</ul>

<p align="center">
<img src="/assets/built/images/msai/animal_1.jpg" />
</p>

<ul>
  <li>사진에서 볼 수 있듯이 여러개의 바운딩 박스가 그려져 있는 것을 볼 수 있습니다.</li>
  <li>클래스 이름이 가려져 있지만 fox가 0.95로 잡히고, goat는 0.77, cow는 0.40으로 잡히는 것을 볼 수 있었습니다.</li>
  <li>
    <p>다른 테스트 이미지들을 여러개 적용을 해보았는데, 다른 이미지들에서는 바운딩 박스는 잘 잡히지만 물체에 맞는 클래스를 제대로 찾아내지 못하는 현상을 보였습니다.</p>
  </li>
  <li>바운딩 박스를 사용한 후 json파일로 만들었습니다.</li>
</ul>

<p align="center">
<img src="/assets/built/images/msai/json_trans.jpg" />
</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!--
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to 꿈을 향해 나아가자!</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
            
            -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="kcw0331" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/kcw0331">kcw0331</a></h4>
                                
                                    <p>Read <a href="/author/kcw0331">more posts</a> by this author.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/kcw0331">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'http://localhost:4000/tag/msai-miniproject3';
                            var this_page_identifier = '/tag/msai-miniproject3';
                            var this_page_title = 'Msai - 미니프로젝트3 MMDetection(Animal Datasets)';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover1.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; 꿈을 향해 나아가자! &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/msai/">Msai</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/tag/msai-studyknow">Msai - 공부하면서 알게된 것 1</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/tag/msai-miniproject2">Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/tag/msai-pokerimageclassification">Msai - 포커이미지 분류</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/msai/">
                                
                                    See all 6 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/tag/msai-studyknow">
                <div class="post-card-image" style="background-image: url(/assets/built/images/microsoft_logo.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/tag/msai-studyknow">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Msai</span>
                            
                        
                    

                    <h2 class="post-card-title">Msai - 공부하면서 알게된 것 1</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>MSAISchool 공부에 대한 내용을 작성해 보았다. Msai - 1주차(1) Msai - 1주차(2) Msai - 1주차(3) Msai - 포커이미지 분류 Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5 Msai - 미니프로젝트</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="kcw0331" />
                        
                        <span class="post-card-author">
                            <a href="/author/kcw0331/">kcw0331</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/tag/msai-miniproject2">
                <div class="post-card-image" style="background-image: url(/assets/built/images/microsoft_logo.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/tag/msai-miniproject2">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Msai</span>
                            
                        
                    

                    <h2 class="post-card-title">Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>MSAISchool 공부에 대한 내용을 작성해 보았다. Msai - 1주차(1) Msai - 1주차(2) Msai - 1주차(3) Msai - 포커이미지 분류 Msai - 미니프로젝트 2 MMDetection(Wine Label Datasets) and JSON to yolov5 Msai - 미니프로젝트</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="kcw0331" />
                        
                        <span class="post-card-author">
                            <a href="/author/kcw0331/">kcw0331</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      6 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:4000/">
            
            <span>꿈을 향해 나아가자!</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Msai - 미니프로젝트3 MMDetection(Animal Datasets)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Msai+-+%EB%AF%B8%EB%8B%88%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B83+MMDetection%28Animal+Datasets%29&amp;url=https://kcw0331.github.io/tag/msai-miniproject3"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://kcw0331.github.io/tag/msai-miniproject3"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:4000/">꿈을 향해 나아가자!</a> &copy; 2023</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to 꿈을 향해 나아가자!</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
